<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Find Task</title>

    <link rel="stylesheet" href="../css/markpage.css">
    <script src="../js/jquery-1.8.2.min.js"></script>
    <script src="../js/jquery.cookie.js"></script>
</head>
<body>


<ul>
    <li><a href="http://localhost:8080/workerHome">Home</a></li>
    <li><a href="http://localhost:8080/worker/yourtask">Your Task</a></li>
    <li><a href="http://localhost:8080/worker/findtask">Find Task</a></li>
    <li><a href="http://localhost:8080">Log out</a></li>
</ul>

<br/>
<br/>
<br/>

<table width="100%" border="1px" id="ongoing_task">
    <caption>可选中任务</caption>
    <tr>
        <td>任务id</td><td>任务名</td><td>图片数量</td><td>截止时间</td><td></td>
    </tr>

</table>

<script>

    var table_info = document.getElementById('ongoing_task')
    var username = $.cookie("username")

    function load_task(id,name,num_pics,deadline){

        var OneRow = table_info.insertRow()
        var cell1 = OneRow.insertCell()
        var cell2 = OneRow.insertCell()
        var cell3 = OneRow.insertCell()
        var cell4 = OneRow.insertCell()
        var cell5 = OneRow.insertCell()

        cell1.innerHTML = id
        cell2.innerHTML = name
        cell3.innerHTML = num_pics
        cell4.innerHTML = deadline
        cell5.innerHTML = "<button id='AcceptButton' onclick='AcceptTask(this)'>参加任务</button>"
        document.getElementById('AcceptButton').id = id
    }

    //load_task("1","MissionA","10","2018-5-9")
    //load_task("2","MissionB","10","2018-6-1")

    var TaskJsonList = null
    var TaskJsonObjArray = null

    $.ajax({
        url: 'http://localhost:8080/workerFindTask',
        type: 'post',
        async: false,
        data: {
            username:username
        },
        success: function (data) {
            TaskJsonList = data
        },
        error: function() {
            alert('fail')
        }
    })

    TaskJsonObjArray = JSON.parse(TaskJsonList)

    for(var i=1 ; i<TaskJsonObjArray[0].num ; i++){
        var TaskId = TaskJsonObjArray[i].id
        var TaskName = TaskJsonObjArray[i].name
        var TaskNumPics = TaskJsonObjArray[i].num
        var EndTime = TaskJsonObjArray[i].end_date

        load_task(TaskId,TaskName,TaskNumPics,EndTime)
    }


    function AcceptTask(o){
        var TaskId = o.id
        var WorkerName = username

        $.ajax({
            url: 'http://localhost:8080/workerAcceptTask',
            type: 'post',
            async: false,
            data: {
                taskId:TaskId,
                workerName:WorkerName
            },
            success: function (data) {
                alert(data)
            },
            error: function() {
                alert('fail')
            }
        })

    }

</script>

</body>
</html>